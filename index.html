<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GGTeam - Temp Email</title>
    <!-- Tailwind CSS untuk styling responsif cepat -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome untuk Icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: url('https://images.unsplash.com/photo-1578632767115-351597cf2477?q=80&w=2000&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover;
            color: #fff;
            overflow-x: hidden;
        }

        /* Overlay gelap agar UI terbaca */
        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.8) 0%, rgba(30, 27, 75, 0.7) 100%);
            z-index: -1;
        }

        /* Glassmorphism Effect */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        /* Sakura Animation */
        .sakura {
            position: fixed;
            top: -10vh;
            background: linear-gradient(135deg, #ffb7c5, #ff9eaf);
            border-radius: 15px 0 15px 0;
            opacity: 0.8;
            pointer-events: none;
            z-index: -1;
            animation: fall linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(0vh) translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(110vh) translateX(100px) rotate(360deg); opacity: 0; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 183, 197, 0.5); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255, 183, 197, 0.8); }

        /* Loader */
        .loader {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #ffb7c5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Clean Iframe for Email Body */
        #email-body-frame {
            width: 100%;
            height: 100%;
            min-height: 400px;
            border: none;
            background-color: white;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Animasi Background & Overlay -->
    <div class="overlay"></div>
    <div id="sakura-container"></div>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 glass p-6 rounded-2xl">
            <div class="flex items-center gap-4 mb-4 md:mb-0">
                <div class="w-12 h-12 rounded-full bg-gradient-to-tr from-pink-500 to-purple-500 flex items-center justify-center text-2xl shadow-[0_0_15px_rgba(236,72,153,0.5)]">
                    <i class="fa-solid fa-envelope-open-text"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-pink-300 to-purple-300 tracking-wider">GGTeam</h1>
                    <p class="text-sm text-gray-300">Temporary Email</p>
                </div>
            </div>
        </header>

        <!-- Email Control Panel -->
        <div class="glass p-6 rounded-2xl mb-8">
            <div class="flex flex-col md:flex-row gap-4">
                
                <!-- Display Current Email -->
                <div class="flex-1">
                    <label class="block text-sm text-pink-200 mb-2 font-semibold">Alamat Email Anda Saat Ini:</label>
                    <div class="flex relative">
                        <input type="text" id="current-email" readonly value="loading..." 
                               class="w-full bg-black/40 border border-pink-500/30 text-white rounded-l-lg p-4 text-lg outline-none font-mono">
                        <button onclick="copyEmail()" class="bg-pink-600 hover:bg-pink-700 px-6 rounded-r-lg font-bold transition-colors flex items-center justify-center gap-2">
                            <i class="fa-regular fa-copy"></i> Copy
                        </button>
                    </div>
                </div>

                <!-- Custom Email Generator -->
                <div class="flex-1 border-t md:border-t-0 md:border-l border-white/10 pt-4 md:pt-0 md:pl-6">
                    <label class="block text-sm text-pink-200 mb-2 font-semibold">Buat Custom Email:</label>
                    <div class="flex gap-2">
                        <input type="text" id="custom-name" placeholder="nama-bebas" 
                               class="w-1/2 bg-black/40 border border-white/20 text-white rounded-lg p-3 outline-none focus:border-pink-500 focus:ring-1 focus:ring-pink-500 transition-all">
                        <span class="flex items-center text-xl text-pink-400 font-bold">@</span>
                        <select id="domain-select" class="w-1/2 bg-black/40 border border-white/20 text-white rounded-lg p-3 outline-none focus:border-pink-500 appearance-none">
                            <option value="jitupasna.online">jitupasna.online</option>
                            <option value="satu.jitupasna.online">satu.jitupasna.online</option>
                            <option value="dua.jitupasna.online">dua.jitupasna.online</option>
                            <option value="tiga.jitupasna.online">tiga.jitupasna.online</option>
                        </select>
                    </div>
                    <div class="flex gap-2 mt-3">
                        <button onclick="setCustomEmail()" class="flex-1 bg-purple-600 hover:bg-purple-700 py-2 rounded-lg font-bold transition-all shadow-[0_0_10px_rgba(147,51,234,0.3)]">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> Buat
                        </button>
                        <button onclick="generateRandom()" class="px-4 bg-gray-600 hover:bg-gray-700 rounded-lg transition-all" title="Acak Email">
                            <i class="fa-solid fa-dice"></i>
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Main Content: Inbox & Reader -->
        <div class="flex flex-col lg:flex-row gap-6 h-[600px]">
            
            <!-- Inbox List (Left) -->
            <div class="lg:w-1/3 glass rounded-2xl flex flex-col overflow-hidden">
                <div class="p-4 border-b border-white/10 bg-black/20 flex justify-between items-center">
                    <h2 class="font-bold text-lg"><i class="fa-solid fa-inbox text-pink-400 mr-2"></i> Kotak Masuk</h2>
                    <div class="flex items-center gap-3 text-sm text-gray-300">
                        <div id="sync-icon" class="hidden loader"></div>
                        <button onclick="manualRefresh()" class="w-8 h-8 flex items-center justify-center bg-white/10 hover:bg-pink-500/50 rounded-full transition-all text-pink-300 hover:text-white shadow-lg" title="Cek Email Baru (Refresh)">
                            <i class="fa-solid fa-rotate-right"></i>
                        </button>
                    </div>
                </div>
                
                <div id="inbox-list" class="flex-1 overflow-y-auto p-2">
                    <!-- Email Items will be injected here -->
                    <div class="text-center text-gray-400 mt-10">
                        <i class="fa-regular fa-folder-open text-4xl mb-3 opacity-50"></i>
                        <p>Belum ada email masuk...</p>
                    </div>
                </div>
            </div>

            <!-- Email Reader (Right) -->
            <div class="lg:w-2/3 glass rounded-2xl flex flex-col overflow-hidden relative">
                <!-- Header Email Reader -->
                <div id="reader-header" class="p-4 border-b border-white/10 bg-black/20 flex justify-between items-start hidden">
                    <div class="flex-1 overflow-hidden">
                        <h2 id="view-subject" class="font-bold text-xl mb-1 truncate">Subject</h2>
                        <p class="text-sm text-gray-300 truncate">Dari: <span id="view-sender" class="font-semibold text-pink-300"></span></p>
                        <p class="text-xs text-gray-400 mt-1" id="view-date"></p>
                    </div>
                    <button onclick="deleteCurrentEmail()" class="ml-4 p-2 bg-red-500/20 hover:bg-red-500 text-red-300 hover:text-white rounded-lg transition-colors group">
                        <i class="fa-solid fa-trash-can group-hover:animate-bounce"></i>
                    </button>
                </div>

                <!-- Body Email Reader -->
                <div class="flex-1 bg-white relative">
                    <!-- Placeholder when no email selected -->
                    <div id="reader-placeholder" class="absolute inset-0 flex flex-col items-center justify-center bg-black/40 text-gray-300 backdrop-blur-md">
                        <img src="https://media1.tenor.com/m/oWQYkS0oGMAAAAAd/anime-mail.gif" alt="Mail Anime" class="w-48 rounded-xl mb-4 opacity-80 mix-blend-screen">
                        <p class="text-lg font-semibold">Pilih email untuk membaca</p>
                    </div>
                    
                    <!-- Iframe for displaying clean raw HTML from email without breaking our CSS -->
                    <iframe id="email-body-frame" class="hidden"></iframe>
                </div>
            </div>
        </div>

    </div>

    <!-- Notifikasi Toast -->
    <div id="toast" class="fixed bottom-5 right-5 bg-pink-600 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-3">
        <i class="fa-solid fa-circle-check"></i>
        <span id="toast-msg">Berhasil!</span>
    </div>

    <!-- SCRIPT LOGIKA -->
    <script>
        // --- ANIMASI SAKURA BACKGROUND ---
        function createSakura() {
            const container = document.getElementById('sakura-container');
            const petalCount = 30;
            
            for(let i=0; i<petalCount; i++) {
                let petal = document.createElement('div');
                petal.classList.add('sakura');
                
                // Random properties
                let size = Math.random() * 10 + 5; // 5px to 15px
                let left = Math.random() * 100; // 0vw to 100vw
                let duration = Math.random() * 5 + 5; // 5s to 10s
                let delay = Math.random() * 5;
                
                petal.style.width = `${size}px`;
                petal.style.height = `${size}px`;
                petal.style.left = `${left}vw`;
                petal.style.animationDuration = `${duration}s`;
                petal.style.animationDelay = `${delay}s`;
                
                container.appendChild(petal);
            }
        }
        createSakura();


        // --- STATE & VARIABEL APLIKASI ---
        let currentEmailAddress = "";
        let inboxData = [];
        let activeEmailId = null;
        let pollingInterval = null;

        const DOMAINS = ['jitupasna.online', 'satu.jitupasna.online', 'dua.jitupasna.online', 'tiga.jitupasna.online'];
        
        // --- INISIALISASI ---
        window.onload = () => {
            generateRandom(); // Buat email random saat web dimuat
            startRealtimeCheck(); // Mulai simulasi cek email masuk
        };


        // --- FUNGSI EMAIL ADDRESS ---
        function generateRandom() {
            const randomString = Math.random().toString(36).substring(2, 10);
            const randomDomain = DOMAINS[Math.floor(Math.random() * DOMAINS.length)];
            currentEmailAddress = `${randomString}@${randomDomain}`;
            
            document.getElementById('current-email').value = currentEmailAddress;
            document.getElementById('custom-name').value = randomString;
            document.getElementById('domain-select').value = randomDomain;
            
            resetInbox();
            showToast("Alamat Email Baru Dibuat!");
        }

        function setCustomEmail() {
            const name = document.getElementById('custom-name').value.trim().toLowerCase().replace(/[^a-z0-9.-]/g, '');
            const domain = document.getElementById('domain-select').value;
            
            if(!name) {
                showToast("Nama email tidak boleh kosong!", true);
                return;
            }

            currentEmailAddress = `${name}@${domain}`;
            document.getElementById('current-email').value = currentEmailAddress;
            
            resetInbox();
            showToast(`Email diubah ke: ${currentEmailAddress}`);
        }

        function copyEmail() {
            const emailInput = document.getElementById('current-email');
            emailInput.select();
            emailInput.setSelectionRange(0, 99999); // Untuk Mobile
            try {
                navigator.clipboard.writeText(emailInput.value);
                showToast("Alamat Email disalin ke clipboard!");
            } catch(e) {
                document.execCommand('copy');
                showToast("Alamat Email disalin!");
            }
        }


        // --- FUNGSI KOTAK MASUK (INBOX) & API MOCK ---
        function resetInbox() {
            inboxData = [];
            activeEmailId = null;
            renderInbox();
            hideEmailReader();
        }

        function startRealtimeCheck() {
            // Mengecek API setiap 5 detik
            pollingInterval = setInterval(fetchEmailsFromServer, 5000);
        }

        function manualRefresh() {
            showToast("Mengecek kotak masuk...", false);
            const icon = document.querySelector('.fa-rotate-right');
            icon.classList.add('animate-spin');
            
            fetchEmailsFromServer().then(() => {
                setTimeout(() => icon.classList.remove('animate-spin'), 600);
            });
        }

        // --- FETCH DARI BACKEND CLOUDFLARE WORKER ---
        async function fetchEmailsFromServer() {
            // GANTI URL DI BAWAH DENGAN URL WORKER CLOUDFLARE ANDA!
            // Contoh: https://jitumail-api.username.workers.dev
            const WORKER_URL = "https://mail.ggteam.workers.dev"; 
            
            if(!currentEmailAddress) return;
            
            document.getElementById('sync-icon').classList.remove('hidden');
            
            try {
                // Memanggil endpoint GET /api/emails
                const response = await fetch(`${WORKER_URL}/api/emails?address=${currentEmailAddress}`);
                
                if (!response.ok) throw new Error("Gagal terhubung ke server");
                
                const data = await response.json();
                
                // Jika ada email baru (jumlah email di server > jumlah di local web)
                if(data.emails && data.emails.length > inboxData.length) {
                    const diff = data.emails.length - inboxData.length;
                    inboxData = data.emails;
                    renderInbox();
                    showToast(`Ada ${diff} Email Baru Masuk! ðŸŒ¸`);
                } else if (data.emails) {
                    // Update data agar tetap sinkron
                    inboxData = data.emails;
                    renderInbox();
                }

            } catch (error) {
                console.error("Gagal mengambil email:", error);
                // Matikan notifikasi error terus-menerus saat auto-refresh, hanya log di console
            } finally {
                setTimeout(() => {
                    document.getElementById('sync-icon').classList.add('hidden');
                }, 500);
            }
        }

        function renderInbox() {
            const listContainer = document.getElementById('inbox-list');
            
            if (inboxData.length === 0) {
                listContainer.innerHTML = `
                    <div class="text-center text-gray-400 mt-10">
                        <i class="fa-solid fa-radar text-4xl mb-3 opacity-50 block"></i>
                        <p>Belum ada email masuk...</p>
                        <p class="text-xs mt-2 text-pink-300/60">Klik tombol refresh di atas</p>
                    </div>`;
                return;
            }

            let html = '';
            inboxData.forEach(email => {
                const isActive = email.id === activeEmailId ? 'bg-pink-500/20 border-l-4 border-pink-500' : 'bg-black/30 hover:bg-white/5 border-l-4 border-transparent';
                
                html += `
                    <div onclick="viewEmail('${email.id}')" class="cursor-pointer p-4 mb-2 rounded-r-lg transition-all duration-200 ${isActive}">
                        <div class="flex justify-between items-center mb-1">
                            <h3 class="font-bold text-pink-200 truncate w-3/4">${email.sender}</h3>
                            <span class="text-xs text-gray-400 whitespace-nowrap">${email.date}</span>
                        </div>
                        <p class="text-sm text-gray-300 truncate">${email.subject}</p>
                    </div>
                `;
            });
            listContainer.innerHTML = html;
        }

        function viewEmail(id) {
            activeEmailId = id;
            renderInbox(); // Update highlight
            
            const email = inboxData.find(e => e.id === id);
            if(!email) return;

            // Update Header Pembaca
            document.getElementById('view-subject').textContent = email.subject;
            document.getElementById('view-sender').textContent = email.sender;
            document.getElementById('view-date').textContent = email.date;
            
            // Tampilkan Header
            document.getElementById('reader-header').classList.remove('hidden');
            document.getElementById('reader-placeholder').classList.add('hidden');
            
            // Render Isi Bersih di dalam Iframe (PENTING untuk mencegah bentrok CSS)
            const iframe = document.getElementById('email-body-frame');
            iframe.classList.remove('hidden');
            iframe.srcdoc = email.bodyHtml || email.bodyText || "Isi email kosong.";
        }

        function hideEmailReader() {
            document.getElementById('reader-header').classList.add('hidden');
            document.getElementById('reader-placeholder').classList.remove('hidden');
            document.getElementById('email-body-frame').classList.add('hidden');
            document.getElementById('email-body-frame').srcdoc = "";
        }

        function deleteCurrentEmail() {
            if(!activeEmailId) return;
            
            // Hapus dari array
            inboxData = inboxData.filter(e => e.id !== activeEmailId);
            
            showToast("Email berhasil dihapus");
            activeEmailId = null;
            renderInbox();
            hideEmailReader();
        }


        // --- UI UTILITIES ---
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const msgEl = document.getElementById('toast-msg');
            const icon = toast.querySelector('i');
            
            msgEl.textContent = message;
            
            if(isError) {
                toast.classList.replace('bg-pink-600', 'bg-red-600');
                icon.className = "fa-solid fa-circle-exclamation";
            } else {
                toast.classList.replace('bg-red-600', 'bg-pink-600');
                icon.className = "fa-solid fa-circle-check";
            }

            toast.classList.remove('translate-y-20', 'opacity-0');
            
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
    </script>
</body>
</html>
